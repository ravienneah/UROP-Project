---
title: "Ravienne UROP - Zoe's Code"
date: 
output: html_notebook
---

```{r echo=FALSE}
library(tidyverse)
```

```{r echo=FALSE}
#loading data locally
load(
  "~/Desktop/QPL/urop_ravienne/ICPSR UROP Data/ICPSR_21600 4/DS0005/21600-0005-Data.rda"
)
load(
  "~/Desktop/QPL/urop_ravienne/ICPSR UROP Data/ICPSR_21600/DS0001/21600-0001-Data.rda"
)
load(
  "~/Desktop/QPL/urop_ravienne/ICPSR UROP Data/ICPSR_21600 8/DS0022/21600-0022-Data.rda"
)
```

## **Ravienne's code as of 03/09/25**

1)  selecting the variables from each wave and organizing them

```{r}

w1vars <- da21600.0001 %>% select(AID, H1TO12, H1TO17)
w2vars <- da21600.0005 %>% select(AID, H2ED19, H2ED17, H2PR1, H2PR2, H2PR3, H2PR4)
w4vars <- da21600.0022 %>% select(
  AID,
  H4MA1,
  H4MA3,
  H4MA5,
  H4TO51,
  H4TO58,
  H4TO46,
  H4TO48,
  H4TO52,
  H4TO47,
  H4TO53,
  H4TO54,
  H4TO55,
  H4TO56,
  H4TO59,
  H4TO60,
  H4TO61,
  H4TO62
)
```

2)  merging the variables by AID
```{r}
merg1 <- merge(data_wave1, data_wave2, by = "AID")
merg2 <- merge(merg1, w4vars, by = "AID")
```

3)  use dplyr function mutate to combine variables from subvariables e.g. ACEs
```{r}
#aces :
merg2$emotional_abuse <- as.numeric(merg2$H4MA1 == "(5) (5) More than ten times")
merg2$physical_abuse <- as.numeric(
  merg2$H4MA3 == "(3) (3) Three to five times" |
    merg2$H4MA3 == "(4) (4) Six to ten times" |
    merg2$H4MA3 == "(5) (5) More than ten times"
)
merg2$sexual_abuse <- as.numeric(merg2$H4MA5 != "(6) (6) This has never happened")
merg2 <- merg2 %>% mutate(aces = emotional_abuse + physical_abuse + sexual_abuse)

#early life substance use :
merg2$early_life_alc_use <- as.numeric(merg2$H1TO12 == "(1) (1) Yes")
merg2$early_life_heavy_drinking <- levels(merg2$H1TO17) <- c(6, 5, 4, 3, 2, 1, 0)
merg2 <- merg2 %>% mutate(early_life_subst_use = early_life_alc_use + early_life_heavy_drinking)
```

```{r}
#problematic substance use - create a manual diagnosis variable and send dr liu the codebooks
```

```{r}
#perceived discriminiation
merg2$teacher_discrimination <- levels(merg2$H2ED19) = c(1, 2, 3, 4, 5)
merg2$peer_prejudice <- levels(merg2$H2ED17) = c(5, 4, 3, 2, 1)
merg2 <- merg2 %>% mutate(perceived_discrimination = teacher_discrimination + peer_prejudice)

#perceived social support
merg2$adult_support <- levels(merg2$H2PR1) = c(1, 2, 3, 4, 5)
merg2$teacher_support <- levels(merg2$H2PR2) = c(1, 2, 3, 4, 5)
merg2$parent_support <- levels(merg2$H2PR3) = c(1, 2, 3, 4, 5)
merg2$peer_support <- levels(merg2$H2PR4) = c(1, 2, 3, 4, 5)
merg2 <- merg2 %>% mutate(perceived_social_support = adult_support + teacher_support + parent_support + peer_support)
```

## **Zoe's first edit of code (just tweaking code style)**

1)  selecting the variables from each wave and organizing them

```{r}
#wave 1 variables
data_wave1 <- da21600.0001 |> 
  select(
    AID, H1TO12, H1TO17
    )
#wave 2 variables
data_wave2 <- da21600.0005 |> 
  select(
    AID, H2ED19, H2ED17, H2PR1, H2PR2, H2PR3, H2PR4
    )
#wave 4 variables
data_wave4 <- da21600.0022 |>
  select(
    AID,
    H4MA1,
    H4MA3,
    H4MA5,
    H4TO51,
    H4TO58,
    H4TO46,
    H4TO48,
    H4TO52,
    H4TO47,
    H4TO53,
    H4TO54,
    H4TO55,
    H4TO56,
    H4TO59,
    H4TO60,
    H4TO61,
    H4TO62
  )
```

2)  merging the variables by AID
```{r}
data_waves1and2 <- merge(
  data_wave1, 
  data_wave2, 
  by = "AID"
  )
data_waves124 <- merge(
  data_waves1and2,
  data_wave4,
  by = "AID"
  )
```

3)  use dplyr function mutate to combine variables from subvariables e.g. ACEs
```{r}
#aces :
data_waves124$emotional_abuse <- as.numeric(data_waves124$H4MA1 == "(5) (5) More than ten times")

data_waves124$physical_abuse <- as.numeric(
  data_waves124$H4MA3 == "(3) (3) Three to five times" |
    data_waves124$H4MA3 == "(4) (4) Six to ten times" |
    data_waves124$H4MA3 == "(5) (5) More than ten times"
)

data_waves124$sexual_abuse <- as.numeric(data_waves124$H4MA5 != "(6) (6) This has never happened")
data_waves124 <- data_waves124 |>
  mutate(aces = emotional_abuse + physical_abuse + sexual_abuse)

#early life substance use :
data_waves124$early_life_alc_use <- as.numeric(
  data_waves124$H1TO12 == "(1) (1) Yes")
data_waves124$H1TO17 <- factor(
  data_waves124$H1TO17,
  levels = c(
    "(6) (6)",
    "(5) (5)",
    "(4) (4)",
    "(3) (3)",
    "(2) (2)",
    "(1) (1)",
    "(0) (0)"
  )
)
data_waves124$early_life_heavy_drinking <- as.numeric(
  levels(
    data_waves124$H1TO17
    ))[data_waves124$H1TO17]
data_waves124 <- data_waves124 |> 
  mutate(early_life_subst_use = early_life_alc_use + early_life_heavy_drinking)
```

```{r}
#problematic substance use - create a manual diagnosis variable and send dr liu the codebooks
```

```{r}
#perceived discriminiation
data_waves124$H2ED19 <- factor(data_waves124$H2ED19,
                               levels = c("(1) (1)", "(2) (2)", "(3) (3)", "(4) (4)", "(5) (5)"))
data_waves124$teacher_discrimination <- as.numeric(levels(data_waves124$H2ED19))[data_waves124$H2ED19]
data_waves124$H2ED17 <- factor(data_waves124$H2ED17,
                               levels = c("(5) (5)", "(4) (4)", "(3) (3)", "(2) (2)", "(1) (1)"))
data_waves124$peer_prejudice <- as.numeric(levels(data_waves124$H2ED17))[data_waves124$H2ED17]
data_waves124 <- data_waves124 %>% mutate(perceived_discrimination =
                                            teacher_discrimination + peer_prejudice)

#perceived social support
data_waves124$H2PR1 <- factor(data_waves124$H2PR1,
                              levels = c("(1) (1)", "(2) (2)", "(3) (3)", "(4) (4)", "(5) (5)"))
data_waves124$adult_support <- as.numeric(levels(data_waves124$H2PR1))[data_waves124$H2PR1]
data_waves124$H2PR2 <- factor(data_waves124$H2PR2,
                              levels = c("(1) (1)", "(2) (2)", "(3) (3)", "(4) (4)", "(5) (5)"))
data_waves124$teacher_support <- as.numeric(levels(data_waves124$H2PR2))[data_waves124$H2PR2]
data_waves124$H2PR3 <- factor(data_waves124$H2PR3,
                              levels = c("(1) (1)", "(2) (2)", "(3) (3)", "(4) (4)", "(5) (5)"))
data_waves124$parent_support <- as.numeric(levels(data_waves124$H2PR3))[data_waves124$H2PR3]
data_waves124$H2PR4 <- factor(data_waves124$H2PR4,
                              levels = c("(1) (1)", "(2) (2)", "(3) (3)", "(4) (4)", "(5) (5)"))
data_waves124$peer_support <- as.numeric(levels(data_waves124$H2PR4))[data_waves124$H2PR4]
data_waves124 <- data_waves124 %>% mutate(perceived_social_support = adult_support + teacher_support + parent_support + peer_support)
```

